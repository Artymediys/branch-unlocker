# Bun – Branch Unlocker

Приложение для снятия защиты с веток в проектах GitLab

## Конфигурационный файл
Пример конфига лежит в `./env/config.json`, а также представлен ниже:

```json
{
  "url": "https://gitlab.example.com",
  "token": "gitlab-token",
  "group_id": 1234,
  "branches": [
    "master",
    "rc",
    "production",
    "*"
  ]
}
```

- `url` – Адрес **GitLab**
- `token` – PAT (Personal Access Token) юзера **GitLab**
- `group_id` – ID группы, в проектах которой будет сниматься защита с указанных веток
- `branches` – Список веток и/или wildcard-ов, с которых будет сниматься защита


## Запуск
Приложение можно запустить, используя заранее собранные исполняемые файлы, находящиеся в директории `./bin`.

Также есть вариант собрать приложение самостоятельно, как это описано в разделе [Сборка](#сборка).

Для запуска приложения, требуется указать конфигурационный файл с помощью флага `-config`.

**Пример:**
```shell
./bin/linux/bsync_amd64 -config ./env/config.json
```

## Сборка
Требуется установленный **Go** версии `>=1.22.5`.

В корне репозитория находится bash-скрипт `build.sh` для сборки приложения под необходимую ОС и архитектуру.

Скрипт можно запустить вместе с аргументами:
1) Сборка приложения под предустановленные ОС и архитектуры, а именно –> **windows amd64**; **linux amd64**;
   **macos amd64** и **arm64**
```shell
./build.sh all
```

2) Сборка приложения под конкретную ОС. Из доступных вариантов -> **windows**; **linux**, **macos**
```shell
./build.sh <ОС>
```

Также скрипт можно запустить без аргументов. Тогда он соберёт приложение под текущую ОС и архитектуру,
на которых был запущен скрипт:
```shell
./build.sh
```

Если требуется собрать приложение под ОС или архитектуру, которых нет в стандартном наборе скрипта `build.sh`,
тогда можно посмотреть список доступных для сборки ОС и архитектуры командой:
```shell
go tool dist list
```
после чего выполнить следующую команду для сборки:

**Linux/MacOS**
```shell
env GOOS=<ОС> GOARCH=<архитектура> go build -o <название итогового файла>
```

**Windows/Powershell**
```shell
$env:GOOS="<ОС>"; $env:GOARCH="<архитектура>"; go build -o <название итогового файла>
```

**Windows/cmd**
```shell
set GOOS=<ОС> && set GOARCH=<архитектура> && go build -o <название итогового файла>
```